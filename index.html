<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image to FreeRiderHD Track</title>
</head>
<body>
    <h2>Upload an Image to Convert to FreeRiderHD Track</h2>
    <input type="file" id="imageInput" accept="image/*">
    <canvas id="canvas" style="display: none;"></canvas>
    <button onclick="convertImageToTrack()">Convert</button>
    <p id="output"></p>

    <script>
        async function convertImageToTrack() {
            const fileInput = document.getElementById('imageInput');
            if (!fileInput.files.length) {
                alert("Please select an image");
                return;
            }

            const file = fileInput.files[0];
            const img = new Image();
            img.src = URL.createObjectURL(file);

            img.onload = () => {
                const canvas = document.getElementById('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                const imageData = ctx.getImageData(0, 0, img.width, img.height);
                const edges = applyEdgeDetection(imageData);
                
                let trackLines = [];
                for (let y = 0; y < edges.height; y++) {
                    for (let x = 0; x < edges.width; x++) {
                        if (edges.data[y * edges.width + x] === 255) {
                            trackLines.push({ x1: x, y1: y, x2: x + 1, y2: y + 1 });
                        }
                    }
                }
                
                const trackData = {
                    name: "Generated Track",
                    lines: trackLines.map(line => ({
                        x1: line.x1, y1: line.y1,
                        x2: line.x2, y2: line.y2,
                        scenery: false
                    }))
                };
                
                const trackCode = btoa(JSON.stringify(trackData));
                document.getElementById("output").textContent = "Generated FreeRiderHD Track Code: " + trackCode;
            };
        }

        function applyEdgeDetection(imageData) {
            const width = imageData.width;
            const height = imageData.height;
            let edges = new Uint8ClampedArray(width * height);
            
            for (let i = 0; i < imageData.data.length; i += 4) {
                let avg = (imageData.data[i] + imageData.data[i + 1] + imageData.data[i + 2]) / 3;
                edges[i / 4] = avg < 128 ? 255 : 0;
            }
            
            return { data: edges, width, height };
        }
    </script>

    <!-- Place external script outside of the inline script -->
    <script src="script.js"></script>

</body>
</html>
